<div class="flex flex-col w-full h-full bg-slate-50 overflow-hidden">

  <header class="flex items-center justify-between px-6 py-3 bg-white border-b border-slate-200 shadow-sm z-20 shrink-0">

    <div class="flex items-center gap-4 min-w-0">
      <div class="hidden md:flex items-center justify-center w-10 h-10 rounded-lg bg-emerald-100 text-emerald-600 shrink-0">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
          <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 9.776c.112-.017.227-.026.344-.026h15.812c.117 0 .232.009.344.026m-16.5 0a2.25 2.25 0 0 0-1.883 2.542l.857 6a2.25 2.25 0 0 0 2.227 1.932H19.05a2.25 2.25 0 0 0 2.227-1.932l.857-6a2.25 2.25 0 0 0-1.883-2.542m-16.5 0V6A2.25 2.25 0 0 1 6 3.75h3.879a1.5 1.5 0 0 1 1.06.44l2.122 2.12a1.5 1.5 0 0 0 1.06.44H18A2.25 2.25 0 0 1 20.25 9v.776" />
        </svg>
      </div>

      <div class="flex gap-2 min-w-0">
        @if (projectContext.isProjectOwner() && !projectContext.onlyView()) {
                        <input
                class="w-full text-xl font-bold text-slate-800 placeholder:text-slate-300 border-none focus:ring-0 p-0 bg-transparent transition-colors hover:bg-slate-50 rounded"
                (blur)="updateProject(project().project.id, { name: name() })"
                (keyup.enter)="updateProject(project().project.id, { name: name() })"
                placeholder="Task Title"
                [(ngModel)]="name"
                type="text"
                maxlength="60"
              />
        } @else {
          <h3 class="text-xl font-bold text-slate-800 truncate leading-tight">
            {{ project().project.name }}
          </h3>
        }
        <div class="flex items-center gap-2 mt-0.5">
           <span class="inline-flex items-center gap-1.5 px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-wide bg-slate-100 text-slate-500 border border-slate-200">
             {{ project().project.status }} </span>
        </div>
      </div>
    </div>

    <nav class="flex items-center gap-2">

      <button
        class="flex items-center gap-2 px-3 py-2 text-sm font-medium text-slate-600 hover:text-slate-900 hover:bg-slate-100 rounded-lg transition-colors"
        (click)="isMemberOpen.set(!isMemberOpen())"
        title="View Members"
      >
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z" />
        </svg>
        <span class="hidden sm:block">Members</span>
      </button>

      <button
        class="flex items-center gap-2 px-3 py-2 text-sm font-medium text-slate-600 hover:text-slate-900 hover:bg-slate-100 rounded-lg transition-colors"
        (click)="isAboutOpen.set(!isAboutOpen())"
        title="Project Info"
      >
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5">
          <path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z" />
        </svg>
        <span class="hidden sm:block">About</span>
      </button>

      <div class="h-6 w-px bg-slate-300 mx-1"></div>

      <button
        class="p-2 text-slate-500 hover:text-slate-800 hover:bg-slate-100 rounded-lg transition-colors active:bg-slate-200"
        (click)="isOptionsOpen.set(!isOptionsOpen())"
        #btnTrigger
      >
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM12.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM18.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Z" />
        </svg>
      </button>
    </nav>
  </header>

  <div class="flex-1 overflow-hidden relative">
    <app-tasks [columns]="project().columns"></app-tasks>
  </div>

  @if (isMemberOpen()) {
    <app-modal-layout modalTitle="Project Members" (onClose)="isMemberOpen.set(false)">
      <app-members></app-members>
    </app-modal-layout>
  }

  @if (isAboutOpen()) {
    <app-dropdown-layout (onClose)="isAboutOpen.set(false)" class="absolute top-16 right-6 z-30 ">
      <app-about></app-about>
    </app-dropdown-layout>
  }

  @if (isOptionsOpen()) {
    <app-floating-dropdown [trigger]="btnTrigger" (onClose)="isOptionsOpen.set(false)">
      <div class="flex flex-col w-56 bg-white rounded-xl shadow-xl border border-slate-100 py-1.5 overflow-hidden">

        <div class="px-2 pb-1 border-b border-slate-100 mb-1">
          <button (click)="aboutOpen()" class="flex w-full items-center gap-2 px-3 py-2 text-sm text-slate-600 hover:bg-slate-50 hover:text-emerald-600 rounded-md transition-colors text-left">
            <svg class="size-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
            About Project
          </button>
          <button (click)="memberOpen()" class="flex w-full items-center gap-2 px-3 py-2 text-sm text-slate-600 hover:bg-slate-50 hover:text-emerald-600 rounded-md transition-colors text-left">
             <svg class="size-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" /></svg>
            See Members
          </button>
        </div>

        <div class="px-2 flex flex-col gap-0.5">
          <span class="px-3 py-1 text-[10px] font-bold text-slate-400 uppercase tracking-wider">Actions</span>

          @if(projectContext.isProjectActive() && projectContext.canEdit()) {
            <button (click)="updateProject(this.projectId, {status: 'ON_HOLD'})" class="flex w-full items-center gap-2 px-3 py-2 text-sm text-amber-600 hover:bg-amber-50 rounded-md transition-colors text-left">
              <svg class="size-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
              Put On Hold
            </button>
          }
          @if(projectContext.isProjectOnHold() && projectContext.canEdit()) {
            <button (click)="updateProject(this.projectId, {status: 'ACTIVE'})" class="flex w-full items-center gap-2 px-3 py-2 text-sm text-emerald-600 hover:bg-emerald-50 rounded-md transition-colors text-left">
              <svg class="size-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
              Reactivate Project
            </button>
          }
          @if(projectContext.isProjectActive() && projectContext.canEdit()){
             <button (click)="updateProject(this.projectId, {status: 'COMPLETED'})" class="flex w-full items-center gap-2 px-3 py-2 text-sm text-emerald-600 hover:bg-emerald-50 rounded-md transition-colors text-left">
               <svg class="size-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
               Complete Project
             </button>
          }
          @if(projectContext.isProjectActive() && projectContext.canEdit()) {
            <button (click)="updateProject(this.projectId, {status: 'CANCELLED'})" class="flex w-full items-center gap-2 px-3 py-2 text-sm text-red-600 hover:bg-red-50 rounded-md transition-colors text-left">
               <svg class="size-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
               Cancel Project
            </button>
          }
          @if((projectContext.isProjectCancelled() || projectContext.isProjectCompleted()) && projectContext.canEdit()) {
            <button (click)="updateProject(this.projectId, {status: 'ARCHIVED'})" class="flex w-full items-center gap-2 px-3 py-2 text-sm text-slate-500 hover:bg-slate-100 rounded-md transition-colors text-left">
               <svg class="size-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" /></svg>
               Archive Project
            </button>
          }
        </div>
      </div>
    </app-floating-dropdown>
  }

  <router-outlet></router-outlet>
  <router-outlet name="modal"></router-outlet>
</div>
